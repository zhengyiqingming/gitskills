<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.baizhi.dao.AlbumDao">
	
	<resultMap type="com.baizhi.entity.Album" id="a1">
		<id column="id" property="id"/>
		<result column="title" property="title"/>
		<result column="coverImg" property="coverImg"/>
		<result column="count" property="count"/>
		<result column="score" property="score"/>
		<result column="author" property="author"/>
		<result column="broadCast" property="broadCast"/>
		<result column="brief" property="brief"/>
		<result column="publishDate" property="publishDate"/>
		
		<collection property="children" ofType="com.baizhi.entity.Chapter">
			<id column="cid" property="id"/>
			<result column="ctitle" property="title"/>
			<result column="csize" property="size"/>
			<result column="cduration" property="duration"/>
			<result column="cdownloadPath" property="downloadPath"/>
			<result column="cuploadDate" property="uploadDate"/>
			<result column="calbumId" property="albumId"/>
		</collection>
	</resultMap>
	
	<!-- 查询一个 -->
	<select id="queryOneItem" resultType="com.baizhi.entity.Album" parameterType="int">
		select id,title,coverImg,count,score,author,broadCast,brief,publishDate
		from album
		where id=#{id}
	</select>
	
	<!-- 添加专辑 -->
	<insert id="insertItem" parameterType="com.baizhi.entity.Album">
 		insert into album (title,coverImg,count,score,author,broadCast,brief,publishDate) 
 					values(#{title},#{coverImg},#{count},#{score},#{author},#{broadCast},#{brief},#{publishDate})
 	</insert>
 	
 	<!-- 查所有 -->
 	<select id="queryItems" resultMap="a1">
 		select a.*,
 		c.id cid,c.title ctitle,c.size csize,c.duration cduration,c.downloadPath cdownloadPath,c.uploadDate cuploadDate
 		from album a left join chapter c
 		on c.albumId=a.id
 		order by a.id asc
 	</select>
 	
 	<!-- 统计条数 -->
 	<select id="count" resultType="int">
 		select count(*)
 		from album
 	</select>
 	
 	<!-- 分页 -->
 	<select id="queryByPage" resultType="com.baizhi.entity.Album">
		select ai.id, ai.title, ai.coverImg, ai.count, ai.score, ai.author, ai.broadCast, ai.brief, ai.publishdate,
		ch.id cid,ch.title ctitle,ch.size csize,ch.duration cduration,ch.downloadPath cdownloadPath,ch.albumId calbumId,ch.uploadDate cuploadDate
        from album ai left join chapter ch on ai.id=ch.albumId 
        limit ${(curPage-1)*pageSize},${pageSize}	 
	</select>
</mapper>
